<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>dataScraping</title>
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.js"
		integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
	<script src="./js/bootstrap.js"></script>
	<script src="./js/jqurey.number.js"></script>
	<!-- echarts -->
	<script src="./js/echarts.min.js"></script>

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.5/dist/bootstrap-table.min.css">

	</script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
	</script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
		integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
	</script>
	<script src="https://kit.fontawesome.com/a04ef755a4.js" crossorigin="anonymous"></script>
	<!-- BS Table -->
	<script src="https://unpkg.com/bootstrap-table@1.15.5/dist/bootstrap-table.min.js"></script>
	<script src="https://unpkg.com/bootstrap-table@1.15.5/dist/extensions/export/bootstrap-table-export.min.js">
	</script>
	<!-- JS Exports plugin -->
	<script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>
	<script src="https://unpkg.com/tableexport.jquery.plugin/libs/jsPDF/jspdf.min.js"></script>
	<script src="https://unpkg.com/tableexport.jquery.plugin/libs/jsPDF-AutoTable/jspdf.plugin.autotable.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
	<script>
		$(function () {
			//初始化資料報表
			const url = '/listdir' //定義資料報表API位置
			$.ajax({
				url: url,
				method: 'GET',
				dataType: "json",
				success: function (data) {
					var array = data
					var sum = 0
					array.sort(function (a, b) {
						var keyA = new Date(a.start),
							keyB = new Date(b.start);
						// Compare the 2 dates
						if (keyA < keyB) return 1;
						if (keyA > keyB) return -1;
						return 0;
					});
					array.forEach(element => {
						array[sum].id = sum + 1
						var start = new Date(element.start)
						var end = new Date(element.stop)
						var totle = (end.getTime() - start.getTime()) / 1000
						// console.log(totle)
						totle = getDuration(totle)

						array[sum].bucketNumber = {
							bucketNumber: element.bucketNumber,
							name: element.name
						}
						// console.log(totle)
						array[sum].sec = totle
						sum++
					})
					mydata(array)
					// console.log(array)
				},
				error: function (err) {
					console.log(err)
				},
			})
			// input 比對 
			var tempInputVal = null;
			$('.table-responsive').on('focus', 'input', function () {
				tempInputVal = $(this).val()
			})
			$('.table-responsive').on('focusout', 'input', function () {
				if (tempInputVal !== $(this).val()) {
					console.log("this is updata")
					$(this).css("background-color", "#c9c9c9")
				}
			})
			$("form").on("submit", function (event) {
				event.preventDefault();
				$("input").css("background-color", "#fff")
				console.log($(this).serialize());
			});
			// $('form').keypress(function (event) {
			// 	if (event.which === 13) {
			// 		event.preventDefault();
			// 		console.log(123)
			// 	}
			// });

			// 按刷新鍵觸發此動作
			$('.table-responsive').on('click', 'button', function () {
				if (this.name === "refresh") {
					$.ajax({
						url: url,
						method: 'GET',
						dataType: "json",
						success: function (data) {
							var array = data
							var sum = 0
							array.sort(function (a, b) {
								var keyA = new Date(a.start),
									keyB = new Date(b.start);
								// Compare the 2 dates
								if (keyA < keyB) return -1;
								if (keyA > keyB) return 1;
								return 0;
							});
							array.forEach(element => {
								array[sum].id = sum + 1
								var start = new Date(element.start)
								var end = new Date(element.stop)
								var totle = (end.getTime() - start.getTime()) / 1000
								// console.log(totle)
								array[sum].bucketNumber = {
									bucketNumber: element.bucketNumber,
									name: element.name
								}
								totle = getDuration(totle)
								// console.log(totle)
								array[sum].sec = totle
								sum++
							})
							updata(array)
						},
						error: function (err) {
							console.log(err)
						},
					})
				}
			})

			function updata(mydata2) {
				// console.log(mydata2)
				$('#table2').bootstrapTable('refreshOptions', {
					data: mydata2,
					classes: 'table table-borderless table-striped table-hover data-checkbox="true" data-field="',
					exportTypes: ['txt', 'csv', 'excel'], // 導出類型
					exportDataType: 'all', // basic', 'all', 'selected'
					showToggle: true,
					columns: [{
							title: '編號',
							field: 'id',
							align: 'center',
							sortable: 'true',
						},
						{
							title: '桶號',
							field: 'bucketNumber',
							align: 'center',
							sortable: 'true',
							formatter: bucketNumberForm,

						},
						{
							title: '錄影開始時間',
							field: 'start',
							align: 'center',
							sortable: true,

						},
						{
							title: '錄影終止時間',
							field: 'stop',
							align: 'center',
							sortable: true,
						},
						{
							title: '總秒數',
							field: 'sec',
							align: 'center',
							sortable: true,
						},
						{
							title: 'L/F 副料區',
							field: 'maxTempForLF',
							align: 'center',
							sortable: true,
						},
						{
							title: '出鋼室地下樓梯',
							field: 'maxTempForDownStairs',
							align: 'center',
							sortable: true,
						},
						{
							title: 'L/D 2F平台',
							field: 'maxTempForLD',
							align: 'center',
							sortable: true,
						},
						{
							title: '拍照時間',
							field: 'shootingTime',
							align: 'center',
							sortable: true,
						},
					]
				});
			}

			function mydata(mydata2) {
				$('#table2').bootstrapTable({
					data: mydata2,
					classes: 'table table-borderless table-striped table-hover data-checkbox="true" data-field="',
					exportTypes: ['txt', 'csv', 'excel'], // 導出類型
					exportDataType: 'all', // basic', 'all', 'selected'
					showToggle: true,
					columns: [{
							title: '編號',
							field: 'id',
							align: 'center',
							sortable: 'true',
						},
						{
							title: '桶號',
							field: 'bucketNumber',
							align: 'center',
							sortable: 'true',
							formatter: bucketNumberForm,
						},
						{
							title: '錄影開始時間',
							field: 'start',
							align: 'center',
							sortable: true,
						},
						{
							title: '錄影終止時間',
							field: 'stop',
							align: 'center',
							sortable: true,
						},
						{
							title: '總秒數',
							field: 'sec',
							align: 'center',
							sortable: true,
						},
						{
							title: 'L/F 副料區',
							field: 'maxTempForLF',
							align: 'center',
							sortable: true,
						},
						{
							title: '出鋼室地下樓梯',
							field: 'maxTempForDownStairs',
							align: 'center',
							sortable: true,
						},
						{
							title: 'L/D 2F平台',
							field: 'maxTempForLD',
							align: 'center',
							sortable: true,
						},
						{
							title: '拍照時間',
							field: 'shootingTime',
							align: 'center',
							sortable: true,
						},
						{
							title: '警示大於像素-1',
							field: 'alertPixels1',
							align: 'center',
							sortable: true,
						},
						{
							title: '警示大於像素-2',
							field: 'alertPixels2',
							align: 'center',
							sortable: true,
						},
						{
							title: '警示大於像素-3',
							field: 'alertPixels3',
							align: 'center',
							sortable: true,
						},
					]
				});
			}

			// input輸入框
			function bucketNumberForm(e) {
				return ['<input type="number" min="0" style="width:50px" name="' + e.name + '" value="' + e
					.bucketNumber + '">'
				]
			}
			// 秒 轉 分、時、天，並且隱藏時間未到的單位
			function getDuration(second) {
				var days = Math.floor(second / 86400);
				var hours = Math.floor((second % 86400) / 3600);
				var minutes = Math.floor(((second % 86400) % 3600) / 60);
				var seconds = Math.floor(((second % 86400) % 3600) % 60);
				if (second < 60) {
					var duration = seconds + "秒";
				} else if (second >= 60 && second < 3600) {
					var duration = minutes + "分" + seconds + "秒";
				} else if (second >= 3600 && second < 86400) {
					var duration = hours + "時<br />" + minutes + "分" + seconds + "秒";
				} else if (second >= 86400) {
					var duration = days + "天" + hours + "時<br />" + minutes + "分" + seconds + "秒";
				}
				return duration;
			}
		});
	</script>
</head>

<body style="background-color: #e2e2e2;">
	<nav class="navbar sticky-top navbar-expand-lg navbar-dark  bg-gradient" style="background-color: #262626;">
		<div class="container" style="margin-left: 281px;">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a href="index.html" class="nav-link">即時監控</a>
				</li>
				<li class="nav-item">
					<a href="dataScraping.html" class="nav-link">資料分析</a>
				</li>
			</ul>
		</div>
	</nav>
	<div class="container-fluid mt-3 mr-0">
		<div class="row ">
			<div class="col-md-6">
				<!-- 左一---------------------------------------------------------------------------------------------- -->
				<div class="card shadow" style="height:874px;width:942px">
					<div class="card-header title py-1" style="font-size: 14px;font-weight: 900;">
						<div class="row g-1 align-items-center">
							<div class="col-auto">
								<div class="col-form-label subtitle p-0">資料報表</div>
							</div>
						</div>
					</div>
					<div class="card-body" style="font-size: 12px;">
						<div class="table-responsive">
							<form class="data-report">
								<table id="table2" data-height="807" data-show-export="true" data-pagination="false"
									data-click-to-select="true" data-toolbar="#toolbar" data-show-toggle="true"
									data-show-columns="true" data-sortable="true" data-toggle="table2"
									data-search="true" data-live-search="true" data-show-refresh="true"
									data-unique-id="id">
								</table>
								<button hidden="true" type="submit"></button>
							</form>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="row">
					<div class="col-md-12">
						<!-- 下1---------------------------------------------------------------------------------------------- -->
						<div class="card shadow" style="height:296px;">
							<div class="card-header title py-1" style="font-size: 14px;font-weight: 900;">
								<div class="row g-3 align-items-center">
									<div class="col-auto">
										<div class="col-form-label subtitle p-0">錄影回放</div>
									</div>
								</div>
							</div>
							<div class="card-body p-0 ">
								<div class="row align-items-center tri subtitle mx-4 mb-1 pt-1">
									<div class="col-4">
										&nbsp;&nbsp;&nbsp;L/F 副料區
									</div>
									<div class="col-4">
										&nbsp;&nbsp;&nbsp;出鋼室地下樓梯
									</div>
									<div class="col-4">
										&nbsp;&nbsp;&nbsp;L/D 2F平台
									</div>
								</div>
								<video id="videoList" loop controls muted preload src="" class="video2 imgCenter">
								</video>
							</div>
						</div>
					</div>
					<div class="col-md-12 ">
						<!-- 下1---------------------------------------------------------------------------------------------- -->
						<div class="card mt-3 shadow " style="height:273px;">
							<div class="card-header title py-1" style="font-size: 14px;font-weight: 900;">
								<div class="row g-3 align-items-center">
									<div class="col-auto">
										<div class="col-form-label subtitle p-0">趨勢圖</div>
									</div>

								</div>
							</div>
							<div class="card-body p-0 ">
								<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
								<div id="main" style="width: 920px;height:290px;"></div>

							</div>
						</div>
					</div>
					<div class="col-md-12">
						<!-- 下1---------------------------------------------------------------------------------------------- -->
						<div class="card mt-3 shadow" style="height:273px;">
							<div class="card-header title py-1" style="font-size: 14px;font-weight: 900;">
								<div class="row g-3 align-items-center">
									<div class="col-auto">
										<div class="col-form-label subtitle p-0">吊起桶數</div>
									</div>
								</div>
							</div>
							<div class="card-body p-0 ">

								<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
								<div id="main2" style="width: 920px;height:228px;padding-bottom: 0px;">
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 折線圖 -->
	<script type="text/javascript">
		$(document).ready(function () {
			// 基于准备好的dom，初始化echarts实例
			var Trend = echarts.init(document.getElementById('main'));
			const colorPalette2 = ['#7180AC', '#2B4570', '#A8D0DB', '#E49273']
			// 指定图表的配置项和数据
			var testasd = 0;
			var optionTrend = {
				title: {
					// text: ''
				},
				tooltip: {
					trigger: 'axis'
				},
				legend: {
					data: ['L/F 副料區', '出鋼室地下樓梯', 'L/D 2F平台'],
					//   selectedMode: 'single', // 設定顯示單一圖例的圖形，點選可切換
					top: 10,
					right: 0,
					left: "center",
					textStyle: {
						color: '#666',
						fontSize: 9,
					}
				},
				// color: 'colorPalette2',
				grid: {
					left: '2%',
					right: '3%',
					top: '15%',
					containLabel: true, //grid区域是否包含坐标轴的刻度标签。

				},
				toolbox: {
					show: true,
					left: "right",
					top: "top",
					itemSize: 30,
					// show: false,
					feature: {
						// saveAsImage: {}
						myTool2: {
							show: true,
							title: '自動播放',
							icon: 'image://static/play.png',
							onclick: function () {
								console.log(testasd);
								testasd++
								Trend.setOption({
									toolbox: {
										feature: {
											myTool2: {
												title: '暫停',
												icon: 'image://static/pause.png',
											}
										}
									}
								})
							}
						}
					}
				},
				xAxis: {
					type: 'category',
					boundaryGap: false,
					name: '(s)',
					show: true,
					interval: 1,
					triggerEvent: true,
					boundaryGap: false,
					// boundaryGap: true,
				},
				yAxis: {
					// type: 'value'

					type: 'value',
					name: '(°C)',
					min: 300,
					max: 350,
					show: true,
				},
				series: [{
						name: 'L/F 副料區',
						type: 'line',
						smooth: true,
					},
					{
						name: '出鋼室地下樓梯',
						type: 'line',
						smooth: true,
					},
					{
						name: 'L/D 2F平台',
						type: 'line',
						smooth: true,
					},
				]
			};
			// 使用刚指定的配置项和数据显示图表。
			Trend.setOption(optionTrend);
			Trend.on('click', function (params) {
				var click_this_val = null
				if (params.componentType === 'series') {
					click_this_val = params.name
				} else if (params.componentType === 'xAxis') {
					click_this_val = params.value
				}
				this_video = document.getElementById("videoList");
				this_video.currentTime = click_this_val
				this_video.pause()
			});
			// 讀取目前影片撥放時間(暫無用處)
			// this_video = document.getElementById("videoList");
			// this_video.addEventListener("timeupdate",
			// 	function (ev) {
			// 		// console.log(ev.target.currentTime);
			// 	});
			// 初始化_讓影片以及趨勢圖讀取資料報表第一條
			var initInterval = null;
			initInterval = setInterval(function () {
				const data = $('#table2').bootstrapTable(
					'getRowByUniqueId',
					1)
				if (data.id === 1) {
					getDATA(data)
					clearInterval(initInterval)
				}
			}, 1000)
			// 點擊報表觸發/影片趨勢圖連動
			const testdata = $('#table2').bootstrapTable(
				'getRowByUniqueId',
				1)
			$('.table-responsive').on('click', 'tr', function () {
				if (Interval !== null) {
					clearInterval(Interval)
				}
				var id = parseInt($(this).attr("data-index")) + 1
				const data = $('#table2').bootstrapTable(
					'getRowByUniqueId',
					id)
				getDATA(data)
			})

			function getDATA(data) {
				const url = '/temp/Data/' + data.name + '.txt' //設定api位置
				const video = '../mock_vod/' + data.name + '.mp4'
				$("#videoList").attr("src", video)
				$.ajax({
					url: url,
					method: 'GET',
					dataType: "json",
					success: function (response) {
						Trend.setOption({
							xAxis: {
								data: response.xAxis
							},
							series: [{
									name: 'L/F 副料區',
									data: response.temperature_LF
								},
								{
									name: '出鋼室地下樓梯',
									data: response.temperature_STAIR
								},
								{
									name: 'L/D 2F平台',
									data: response.temperature_LD
								},
							]
						});
						// 自動高亮
						var hover = true //如果鼠標在圖表上，就設定為false 讓Interval不會再更新高亮的index
						var video = document.getElementById("videoList");
						video.removeAttribute("controls")
						$('#videoList').hover(function () {
							if (hover) {
								video.setAttribute("controls", "controls")
								hover = false
							}
						}, function () {
							video.removeAttribute("controls")
							hover = true
						});
						Trend.getZr().on('mousemove', function () {
							if (hover) {
								video.setAttribute("controls", "controls")
								hover = false
							}
						});
						Trend.getZr().on('globalout', function () {
							video.removeAttribute("controls")
							hover = true
						});
						let currentIndex = -1;
						Interval = setInterval(function () {
							if (hover) {
								var dataLen = response.xAxis.length;
								Trend.dispatchAction({
									type: 'downplay',
									seriesIndex: 0,
									dataIndex: currentIndex
								});
								currentIndex = (currentIndex + 1) % dataLen;
								Trend.dispatchAction({
									type: 'highlight',
									seriesIndex: 0,
									dataIndex: currentIndex
								});
								Trend.dispatchAction({
									type: 'showTip',
									seriesIndex: 0,
									dataIndex: currentIndex
								});
								// 影片設定
								this_video = document.getElementById("videoList");
								this_video.currentTime = response.xAxis[currentIndex]
								this_video.pause()
							}
						}, 1500);
					},
					error: function (err) {}
				})
			}
		})
	</script>
	<!-- 熱像圖 -->
	<script type="text/javascript">
		// 基于准备好的dom，初始化echarts实例
		var myChart = echarts.init(document.getElementById('main2'));
		// 指定图表的配置项和数据
		// prettier-ignore
		// (x, y , 0:沒事 1:有事, 拉了幾桶(3桶/hr))

		option = {
			aria: {
				// 下面几行可以不写，因为 label.enabled 默认 true
				// label: {
				// enabled: true
				// },
				enabled: true
			},
			title: {
				textStyle: {
					color: '#6f6f6f',
					fontSize: 12,
					lineHeight: 50,
				},
				x: 'right'
			},
			tooltip: {
				position: 'top'
			},
			animation: false,
			grid: {
				height: '72%',
				top: '20%',
				width: '80%',
				// width: '91%',
				left: '48',
			},
			xAxis: {
				type: 'category',
				name: '(hr)',
				data: ['0', '1', '2', '3', '4', '5', '6',
					'7', '8', '9', '10', '11',
					'12', '13', '14', '15', '16', '17',
					'18', '19', '20', '21', '22', '23'
				],
				splitArea: {
					show: true
				}
			},

			yAxis: {
				type: 'category',
				data: [0, 10, 20, 30, 40, 50],
				name: '(m)',
				splitArea: {
					show: true,
				},
			},
			visualMap: {
				show: true,
				min: 0,
				// max: 5,
				calculable: true,
				// orient: 'horizontal',
				orient: 'vertical',
				top: '45',
				right: '30',
				bottom: '15%',
				// color: ['#F08080', '#000984' ],
				// color: ['#367CEB', '#38B3F5', '#3ED1DE', '#38F5D0', '#A8D0DB', ],
				color: ['#3E5A8E', '#54739A', '#6A8BA6', '#89AEC1', '#a8bcdb'],
				// color: ['#0198E6', '#42C0FF', '#83C5E6'],



			},
			series: [{
				name: '',
				type: 'heatmap',
				label: {
					show: true,
					normal: {
						show: true,
						formatter: function (params) {
							if (params.data['2'] == 0) {
								return '{a|' + params.data['3'] + '}';
							} else if (params.data['2'] == 1) {
								return '{b|' + params.data['3'] + '}';
							}
						},
						rich: {
							a: {
								//  backgroundColor:'#fff',
								color: '#E3DCD3'
							},
							b: {
								backgroundColor: 'red',
								height: '26',
								width: '3',
								shadowOffsetY: '0',
								shadowOffsetX: '0',
								align: 'center',
							},
						}
					}
				},
				emphasis: {
					itemStyle: {
						shadowBlur: 10,
						shadowColor: 'rgba(0, 0, 0, 0.5)'
					}
				}
			}]
		};
		// 使用刚指定的配置项和数据显示图表。
		myChart.setOption(option);
		//初始化資料報表
		const url = '/listdir' //定義資料報表API位置
		$('.table-responsive').on('click', 'button', function () {
			if (this.name === "refresh") {
				getData(url)
			}
		})
		getData(url)

		function getData(url) {
			$.ajax({
				url: url,
				method: 'GET',
				dataType: "json",
				success: function (data) {
					var date = new Date();
					var time = date.getFullYear() +
						"/" +
						(date.getMonth() + 1).toString().padStart(2, '0') +
						"/" +
						date.getDate().toString().padStart(2, '0') +
						" " +
						date.getHours().toString().padStart(2, '0') +
						":" +
						date.getMinutes().toString().padStart(2, '0') +
						":" +
						date.getSeconds().toString().padStart(2, '0');
					var data = listinterval(data)
					// 判斷時段中拉起桶數的最大值
					var max = []
					data.forEach(function (item) {
						max.push(item[3])
					})
					max = Math.max(...max)
					// 判斷時段中拉起桶數的最大值 end
					data = data.map(function (item) {
						return [item[0], item[1], item[2], item[3]];
					})
					myChart.setOption({
						visualMap: {
							max: max
						},
						title: {
							text: '資料最後更新時間:' + time,
						},
						series: [{
							name: '',
							data: data,
						}]
					});
				},
				error: function (err) {
					console.log(err)
				},
			})
		}
		// -------時間計算器
		// setInterval(function () {
		// 	jQuery.ajax({
		// 		url: '/list',
		// 		method: 'GET',
		// 		dataType: "json",
		// 		success: function (res) {
		// 			var data = listinterval(res)
		// 			data = data.map(function (item) {
		// 				return [item[0], item[1], item[2], item[3]];
		// 			})
		// 			myChart.setOption({
		// 				series: [{
		// 					name: '',
		// 					data: data,
		// 				}]
		// 			});
		// 		},
		// 		error: function (err) {
		// 			console.log(err)
		// 		},
		// 	})
		// }, 500)
		// 時間篩選
		function listinterval(res) {
			// 宣告陣列
			var output = []
			// 取得今天日期
			var NowDate = new Date()
			var NYear = NowDate.getFullYear()
			var NMonth = NowDate.getMonth()
			var NDate = NowDate.getDate()
			// 設定間隔時間(設定範圍1~60，並且可除盡60)
			var interval = 10
			// 判斷interval 是否為合理範圍，否則將強制變動
			if (interval === 0) {
				interval = 1
			} else if (interval > 60) {
				interval = 60
			}
			// 計算間隔時間
			setinterval = (1440 / interval) + 1
			// 指標時間變數
			var lastTime = null
			var NewMin = null

			// 間隔十分鐘
			for (var i = 1; i < setinterval; i++) {
				// 宣告日期
				var today = new Date(NYear, NMonth, NDate)
				var today1 = new Date(NYear, NMonth, NDate)
				// 判斷初始，存入起始時間
				if (i == 1) {
					lastTime = new Date(today)
				} else {
					lastTime = new Date(lastTime)
					lastTime = today1.setMinutes(today1.getMinutes() + ((i - 1) * interval))
					lastTime = new Date(lastTime)
				}
				// 結束時間
				NewTime = today.setMinutes(today.getMinutes() + (i * interval))
				NewTime = new Date(NewTime)
				// 判斷時間
				var timeSum = 0;
				var Hours = lastTime.getHours();
				var Minutes = lastTime.getMinutes();
				var status = 0
				res.forEach(function (item) {
					var listTime = new Date(item.start)
					// 判斷間隔時間如果符合，就在此區段增加統計數
					if (listTime > lastTime && listTime < NewTime) {
						// 此區段如果有任何一桶有問題，則將狀態變更為1
						if (item.status === 1) {
							status = 1
						}
						timeSum++
					}
				})
				// 將區段統計結果新增到陣列中
				array = [Hours, (Minutes / 10), status, timeSum]
				output.push(array)
			}
			// 印出陣列
			return output
		}
	</script>
</body>

</html>